<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Weather Map</title>

	<!-- Mapbox -->
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js'></script>
	<!-- Mapbox CSS -->
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css' rel='stylesheet'/>
	<!-- Bootstrap -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
	      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
	<style>
        * {
            Border: red 1px solid;
        }

        body {
            background-color: #404040;
        }

        #map {
            width: 90%;
            height: 400px;
        }

	</style>

</head>

<!--PAGE LAYOUT START-->
<body class="container">
<script src="js/keys.js"></script>

<!--for each on the cards inside the js file-->
<div class="card-group">
	<!--	duplicate the card div-->
	<div class="card">

		<div class="card-body">


		</div>
	</div>
	<!--	card div end-->

</div>

<input type="text" id="searchBox" placeholder="Enter a location here">
<button type="button" id="searchBtn">Search</button>

<div class="col">
	<div id="map" class="m-auto mt-3">
	</div>
</div>

<!--PAGE LAYOUT END-->

<!-- Mapbox Geocoder Util Methods -->
<script src="js/mapbox_geocode_utils.js"></script>

<!--scripts for project    -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"
        integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk"
        crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>

<!--Js script-->
<script>

	//when the the user moves the marker to a new location the marker will update the cards
	//whne the user input a location in the textbox find that location update cards

	// https://api.openweathermap.org/data/2.5/onecall?lat={29.423017}&lon={-98.48527}&exclude={hourly,daily}&appid={"91153175f66a5d3b4967f618fd8e6102"}

	// $.get("https://api.openweathermap.org/data/2.5/forecast", {
	// 	APPID: OWK,
	// 	lat:    29.423017,
	// 	lon:   -98.48527,
	// 	units: "imperial"
	// }).done(function(data) {
	// 	console.log('5 day forecast', data);
	// });

	//displays map on page start
	mapboxgl.accessToken = MBK;
	const map = new mapboxgl.Map({
		container: 'map', // container ID
		style: 'mapbox://styles/mapbox/streets-v11', // style URL
		center: [-98.48527, 29.423017], // starting position [lng, lat]
		zoom: 9 // starting zoom
	});
	//displays map on page end

	//
	// map.addControl(new mapboxgl.FullscreenControl());
	// // restaurants.forEach(function (restaurant) {
	// // 	let marker = new mapboxgl.Marker().setLngLat([restaurant.long, restaurant.lat]).addTo(map);
	// // 	let popup = new mapboxgl.Popup().setHTML("<p>" + restaurant.name + "<br>" + restaurant.info + "</p>" );
	// // 	marker.setPopup(popup);
	// // });
	//

	const marker = new mapboxgl.Marker({
		color: "blue",
		draggable: true
	}).setLngLat([-98.48527, 29.423017])
		.addTo(map);

	//refer to line 252 to get information of the marker




	$("#searchBtn").click(function (e) {
		e.preventDefault();
		console.log($("#searchBox").val());

		let inputStr = $("#searchBox").val();


		$.ajax(`https://api.openweathermap.org/data/2.5/forecast?q=${inputStr}&appid=${OWK}&units=imperial`).done(function (data) {

			let srclat = data.city.coord.lat;
			let srclon = data.city.coord.lon;

			console.log(data)

			$.ajax(`https://api.openweathermap.org/data/2.5/onecall?lat=${srclat}&lon=${srclon}&appid=${OWK}`).done(function (data) {
				console.log(data)

			})


		})})



	// 	$.ajax(`https://api.openweathermap.org/data/2.5/forecast?q=${inputStr}&appid=${OWK}&units=imperial&cnt=5`).done(function (data) {
	// 		console.log(data)
	//
	// 		    // let iconcode = data.list[0]["weather"]["0"]["icon"];
	// 			//
	// 			// let time = data.list[0]["dt_txt"]
	// 			// $(`<p>${time} </p>`).appendTo(".tm")
	// 			//
	// 			// //current temp
	// 			// let currentT = data.list[0]["main"]["temp"]
	// 			// $(`<p>${currentT} </p>`).appendTo(".cT")
	// 			//
	// 			// //mintemp
	// 			// let mintemp = data.list[0]["main"]["temp_min"]
	// 			// $(`<p>${mintemp} </p>`).appendTo(".minT")
	// 			//
	// 			// //maxtemp
	// 			// let maxtemp = data.list[0]["main"]["temp_max"]
	// 			// $(`<p>${maxtemp} </p>`).appendTo(".maxT")
	// 			//
	// 			// //description
	// 			// let description = data.list[0]["weather"]["0"]["description"]
	// 			// $(`<p>${description} </p>`).appendTo(".des")
	// 			//
	// 			//
	// 			// //humidity
	// 			// let humidity = data.list[0]["main"]["humidity"]
	// 			// $(`<p>${humidity} </p>`).appendTo(".hum")
	// 			//
	// 			// //wind speed
	// 			// let windSpeed = data.list[0]["wind"]["speed"];
	// 			// $(`<p>${windSpeed} </p>`).appendTo(".ws")
	// 			//
	// 			// //pressure
	// 			// let pressure = data.list[0]["main"]["pressure"]
	// 			// $(`<p>${pressure} </p>`).appendTo(".pres")
	//
	//
	// 		}
	// 	)
	// })

</script>


</body>

</html>

<!--gh                ---------------------------------------------->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->

<!--<head>-->
<!--	<meta charset="UTF-8">-->
<!--	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->
<!--	<title>Weather Map</title>-->
<!--	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"-->
<!--	      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
<!--	<link href='https://api.mapbox.com/mapbox-gl-js/v2.1.0/mapbox-gl.css' rel='stylesheet'/>-->
<!--	<link rel="preconnect" href="https://fonts.gstatic.com">-->
<!--	<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">-->
<!--	<link rel="stylesheet" href="../CSS/weather_map.css">-->
<!--</head>-->




<!--<body>-->
<!--<div class="nav1">-->
<!--	<nav class="navbar">-->
<!--		<a class="navbar-brand" style="color: black; font-size: 50px; font-weight: bolder">Weather Map</a>-->
<!--		<form class="form-inline">-->
<!--			<input class="form-control mr-sm-2" id="input" type="search" placeholder="Enter by City" aria-label="Search">-->
<!--			<button id="btn" class="btn my-2 my-sm-0" type="submit">Search</button>-->
<!--		</form>-->
<!--	</nav>-->
<!--</div>-->
<!--<section class="container-fluid">-->
<!--	<div class="five">-->
<!--		<h3 style="align-content: center">Five day forecast:</h3>-->
<!--	</div>-->
<!--	<div>-->
<!--		<div class="weatherBox row" id="insertWeatherBoxes"></div>-->
<!--	</div>-->

<!--	<div>-->
<!--		<div class='mx-4 mt-5' id='map' style='width: auto; height: 400px;'></div>-->
<!--		<pre id="coordinates" class="coordinates"></pre>-->
<!--	</div>-->
<!--</section>-->




<!--<script src="../JS/jquery/jquery-2.2.4.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"-->
<!--        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"-->
<!--        crossorigin="anonymous"></script>-->
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"-->
<!--        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"-->
<!--        crossorigin="anonymous"></script>-->
<!--<script src='https://api.mapbox.com/mapbox-gl-js/v2.1.0/mapbox-gl.js'></script>-->
<!--<script src="../JS/keys.js"></script>-->
<!--<script src="../JS/mapbox-geocoder-utils.js"></script>-->
<!--<script>-->
<!--	use strict"-->

<!--	// setting up global variables to call the data from Weather Map-->
<!--	var longitude = -98.7320-->
<!--	var latitude = 29.7947-->

<!--	// Calling initial getData function-->
<!--	getData();-->

<!--	// -&#45;&#45;&#45;&#45;&#45;&#45; Query the Weather Map API &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->

<!--	// String and Object Method:-->
<!--	// Using this method for the sake of readability-->
<!--	// Excluding minutely and hourly.-->
<!--	// Changing kelvins to imperial: Fahrenheit-->
<!--	// Defining the 'get' request as a function 'getData' in order to call it multiple times-->
<!--	function getData() {-->
<!--		$.get("https://api.openweathermap.org/data/2.5/onecall", {-->
<!--			APPID: OPEN_WEATHER_APPID,-->
<!--			lat: latitude,-->
<!--			lon: longitude,-->
<!--			units: "imperial",-->
<!--			exclude: "minutely, hourly"-->
<!--		}).done(function (data) {-->
<!--			handleResponse(data)-->
<!--		});-->
<!--	}-->

<!--	// Setting up handle response to iterate through the returned data and populate the html:-->
<!--	function handleResponse(data) {-->
<!--		let days = data.daily;-->
<!--		let html = "";-->
<!--		for (var i = 0; i < 5; i++) {-->
<!--			let date = dateMaker(i);-->
<!--			let iconCode = days[i].weather[0].icon;-->
<!--			cardColor(iconCode);-->
<!--			let tempHigh = Math.round(days[i].temp.max);-->
<!--			let tempLow = Math.round(days[i].temp.min);-->
<!--			let description = days[i].weather[0].description;-->
<!--// Embedding into the div.card element using string method:-->
<!--			let itemHtml = "<div style='align-items: center; margin-bottom: 50px' class='card col-2' style='width: 17rem'>"-->
<!--			itemHtml += '<span class="date-text">' + date + '</span>';-->
<!--			itemHtml += "<img style='height: 50px; width: 50px;' src='http://openweathermap.org/img/w/" + iconCode + ".png'>" // Refactored the image names of the local icons to work with this-->
<!--			itemHtml += '<h5 class="highText">' + 'High ' + tempHigh + '</h5>';-->
<!--			itemHtml += '<h5 class="lowText">' + 'Low ' + tempLow + '</h5>';-->
<!--			itemHtml += '<p class="card-footer my-1">' + description + '</p>';-->
<!--			itemHtml += '</div>';-->
<!--			html += itemHtml;-->
<!--		}-->
<!--		$('#insertWeatherBoxes').html(html);-->

<!--		//-&#45;&#45;&#45;&#45;&#45;&#45; Map -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->

<!--		mapboxgl.accessToken = MAPBOX_KEY-->
<!--		const map = new mapboxgl.Map({-->
<!--			container: 'map', // container ID-->
<!--			style: 'mapbox://styles/mapbox/light-v10', // style URL-->
<!--			center: [longitude, latitude], // starting position [lng, lat]-->
<!--			zoom: 9 // starting zoom-->
<!--		});-->

<!--// Map Nav Controls-->
<!--		map.addControl(new mapboxgl.NavigationControl());-->

<!--//Starting Draggable Marker (default point)-->
<!--		var marker = new mapboxgl.Marker({-->
<!--			draggable: true-->
<!--		})-->
<!--			.setLngLat([longitude, latitude])-->
<!--			.addTo(map);-->

<!--// Adding functionality to draggable marker-->

<!--		function onDragEnd() {-->
<!--			var lngLat = marker.getLngLat();-->
<!--			longitude = lngLat.lng;-->
<!--			latitude = lngLat.lat;-->
<!--			getData();-->
<!--		}-->
<!--		marker.on('dragend', onDragEnd);-->
<!--	}-->

<!--	// Trying to manipulate the date() object to work with the weather cards.-->
<!--	// Pass the dateMaker function the index number (i) in the handleResponse.-->
<!--	// The setDate() method sets the day of the Date object relative-->
<!--	// to the beginning of the currently set month. -MDN-->
<!--	// The getDate() method returns the day of the month for the specified-->
<!--	// date according to local time. -MDN-->

<!--	function dateMaker(num) {-->
<!--		let date = new Date();-->
<!--		date.setDate(date.getDate() + num)-->
<!--		return date.toDateString().slice(0, 10);-->
<!--	}-->

<!--	// Change the background of the Weather Cards depending on the iconCode-->
<!--	function cardColor (code) {-->
<!--		$('.card').css("background-image", function () {-->
<!--				if (code === "01d") {-->
<!--					return "linear-gradient(45deg, skyblue, skyblue)";-->
<!--				}-->
<!--				if (code === "02d" || "03d" || "10d") {-->
<!--					return "linear-gradient(45deg, skyblue, grey)";-->
<!--				}-->
<!--				if (code === "04d" || "09d" || "11d") {-->
<!--					return "linear-gradient(45deg, lightgray, darkslategrey)";-->
<!--				}-->
<!--				if (code === "50d") {-->
<!--					return "linear-gradient(45deg, gray, ghostwhite)";-->
<!--				}-->
<!--				if (code === "13d") {-->
<!--					return "linear-gradient(45deg, lightgrey, whitesmoke)";-->
<!--				}-->
<!--				else {-->
<!--					return "linear-gradient(45deg, skyblue, grey)";-->
<!--				}-->

<!--			}-->
<!--		)-->
<!--	}-->

<!--	//-&#45;&#45;&#45;&#45;&#45;&#45; Search by City geocode &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->

<!--	$(".btn").click(function (e) {-->
<!--		e.preventDefault()-->
<!--		let searchInput = $("#input").val();-->
<!--		geocode(searchInput, MAPBOX_KEY).then(function (data) {-->
<!--			// console.log();-->
<!--			longitude = data[0];-->
<!--			latitude = data[1];-->
<!--			getData();-->
<!--		})-->

<!--	})-->

<!--</script>-->
<!--</body>-->

<!--</html>-->